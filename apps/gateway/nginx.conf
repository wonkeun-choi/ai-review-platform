events {}

http {
  server {
    # docker-compose.yml의 "80:80" 매핑과 일치시킵니다.
    listen 80;

    # 1. API 요청 ( /api/ 로 시작하는 모든 요청)
    # (예: /api/review/multi, /api/interview)
    location /api/ {
      # /api/ 접두사를 떼어내고 review-engine으로 보냅니다.
      proxy_pass http://review-engine:8000/; 
      
      # --- (기존 interview-gen 관련 블록 삭제) ---
      
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 2. Web UI ( / 로 시작하는 나머지 모든 요청)
    location / {
      # web (Next.js) 서비스로 보냅니다.
      proxy_pass http://web:3000;
      
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
}